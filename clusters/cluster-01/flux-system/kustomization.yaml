apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - gotk-components.yaml
  - gotk-sync.yaml
  - flux-monitoring.yaml
patches:
  - target:
      kind: GitRepository
    patch: |
      - op: replace
        path: /spec/secretRef/name
        value: flux-ssh-key
  # https://github.com/as42sl/helm-charts/commit/f73addb9e373261c2061538e38e3b940f02108c8
  - target:
      kind: CustomResourceDefinition
      name: helmreleases.helm.toolkit.fluxcd.io
    patch: |
      - op: replace
        path: /spec/versions/0/schema/openAPIV3Schema/properties/spec/properties/valuesFrom/items/properties/targetPath/pattern
        value: ^([a-zA-Z0-9_\-.\\\\\\\/]|\[[0-9]{1,5}\])+$
