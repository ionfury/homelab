apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../../manifests/resources/flux
components:
  - ../../../manifests/components/flux-sops-key
  - ../../../manifests/components/flux-ssh-key
namespace: flux-system
patches:
  - target:
      name: flux-system
      kind: Kustomization
    patch: |
      - op: replace
        path: /spec/path
        value: ./clusters/cluster-02
      - op: add
        path: /spec/postBuild
        value:
          substitute:
            cluster_name: cluster-02
