version: "3"

tasks:
  finalize-pending-volume-attachments:
    desc: Remove the finalizers on VolumeAttachments pending deletion to remediate docs/runbooks/unstick-volume-attachments.md.
    cmds:
      - kubectl get volumeattachment -o json | jq -r '.items[] | select(.status.detachError != null)'.metadata.name | xargs -L 1 bash -c 'kubectl patch volumeattachment $0 -p '"'"'{"metadata":{"finalizers":null}}'"'"' --type=merge'
  restart-servarr-stack:
    desc: Restarts the entire servarr stack.
