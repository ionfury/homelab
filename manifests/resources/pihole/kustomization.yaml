namespace: pihole
namePrefix: pihole-

components:
  - ../../../manifests/components/namespace
  - ../../../manifests/components/helm

patches:
  - target:
      kind: HelmRelease
      name: helm-release
    patch: |
      - op: replace
        path: /spec/chart/spec/chart
        value: pihole
      - op: replace
        path: /spec/chart/spec/version
        value: 2.11.1
      - op: add
        path: /spec/dependsOn
        value:
          - name: cert-manager
            namespace: cert-manager
          - name: ingress-nginx-helm-release
            namespace: ingress-nginx
      - op: add
        path: /spec/targetNamespace
        value: pihole
  - target:
      kind: HelmRepository
      name: helm-repository
    patch: |
      - op: replace
        path: /spec/url
        value: https://mojo2600.github.io/pihole-kubernetes/

configMapGenerator:
  - name: values
    behavior: replace
    files:
      - values.yaml

secretGenerator:
  - name: secret-values
    behavior: replace
    files:
      - values.yaml=secret-values.encrypted.yaml
  - name: admin-secret
    behavior: create
    options:
      disableNameSuffixHash: true
    files:
      - password=admin-password.encrypted
