namespaceOverride: ${NAMESPACE}
extraArgs:
  - --metric-labels-allowlist=pods=[*],nodes=[*]
rbac:
  extraRules:
    - apiGroups: ["autoscaling.k8s.io"]
      resources: ["verticalpodautoscalers"]
      verbs: ["list", "watch"]
prometheus:
  monitor:
    enabled: true
# https://github.com/kubernetes/kube-state-metrics/blob/main/docs/customresourcestate-metrics.md#verticalpodautoscaler
# https://github.com/kubernetes/kube-state-metrics/issues/2041#issuecomment-1614327806
customResourceState:
  enabled: true
  config:
    kind: CustomResourceStateMetrics
    spec:
      resources:
        - groupVersionKind:
            group: autoscaling.k8s.io
            kind: "VerticalPodAutoscaler"
            version: "v1"
          labelsFromPath:
            verticalpodautoscaler: [metadata, name]
            namespace: [metadata, namespace]
            target_api_version: [apiVersion]
            target_kind: [spec, targetRef, kind]
            target_name: [spec, targetRef, name]
          metrics:
            - name: "vpa_containerrecommendations_target"
              help: "VPA container recommendations for memory."
              each:
                type: Gauge
                gauge:
                  path:
                    [
                      status,
                      recommendation,
                      containerRecommendations,
                      "0",
                      target,
                      memory,
                    ]
              labelsFromPath:
                container:
                  [
                    status,
                    recommendation,
                    containerRecommendations,
                    "0",
                    containerName,
                  ]
              commonLabels:
                resource: "memory"
                unit: "byte"
            - name: "vpa_containerrecommendations_target"
              help: "VPA container recommendations for cpu."
              each:
                type: Gauge
                gauge:
                  path:
                    [
                      status,
                      recommendation,
                      containerRecommendations,
                      "0",
                      target,
                      cpu,
                    ]
              labelsFromPath:
                container:
                  [
                    status,
                    recommendation,
                    containerRecommendations,
                    "0",
                    containerName,
                  ]
              commonLabels:
                resource: "cpu"
                unit: "core"
selfMonitor:
  enabled: true
