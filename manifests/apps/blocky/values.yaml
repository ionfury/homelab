# ghcr.io/0xerr0r/blocky
podLabels:
  networking/allow-egress-to-internet: "true"
  networking/allow-egress-to-dragonfly: "true"
  networking/allow-egress-to-kubedns: "true"
  networking/allow-ingress-to-prometheus: "true"
  networking/allow-ingress-to-uptime-kuma: "true"
service:
  main:
    annotations:
      cloudprovider.harvesterhci.io/ipam: dhcp
    externalTrafficPolicy: Cluster
    type: LoadBalancer
    ports:
      http:
        enabled: false
      dns:
        port: 53
        protocol: UDP
  metrics:
    ports:
      metrics:
        port: 4000
serviceMonitor:
  metrics:
    enabled: true
    serviceName: blocky-app-metrics
    endpoints:
      - port: metrics
        interval: 30s
        scrapeTimeout: 10s
        path: /metrics
controller:
  annotations:
    reloader.stakater.com/auto: "true"
  replicas: 3
  strategy: RollingUpdate
  rollingUpdate:
    surge: 25%
    unavailable: 25%
probes:
  liveness:
    port: dns
  readiness:
    port: dns
  startup:
    port: dns
persistence:
  config:
    enabled: true
    type: configMap
    name: blocky-config
    mountPath: /app/config.yml
    subPath: config.yml
resources:
  requests:
    cpu: 10m
    memory: 100Mi
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - blocky-app
          topologyKey: kubernetes.io/hostname
