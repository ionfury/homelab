namePrefix: kube-prometheus-stack-
components:
  - ../../components/helm-release-oci
resources:
  - alertmanager-webhook-secret.yaml
configMapGenerator:
  - name: values
    behavior: replace
    files:
      - values.yaml
  - name: grafana-dashboards
    options:
      disableNameSuffixHash: true
      annotations:
        kustomize.toolkit.fluxcd.io/substitute: disabled
      labels:
        grafana_dashboard: "true"
    files:
      - dashboards/resource-utilization.json
patches:
  - target:
      kind: HelmRelease
      name: app
    patch: |
      - op: add
        path: /spec/valuesFrom/-
        value:
          kind: Secret
          name: alertmanager-webhook
