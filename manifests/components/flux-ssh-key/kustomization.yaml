apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component

components:
  - ../configurations/git-repository

secretGenerator:
  - name: flux-ssh-key
    files:
      - identity=values/identity.encrypted
      - values/identity.pub
      - values/known_hosts

patches:
  - target:
      kind: GitRepository
    patch: |
      - op: replace
        path: /spec/secretRef/name
        value: flux-ssh-key