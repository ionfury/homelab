---
controllers:
  main:
    containers:
      main:
        image:
          tag: "${immich_app_version}"
        env:
          DB_HOSTNAME: immich-database-rw.database.svc.cluster.local
          DB_PORT: "5432"
          DB_DATABASE_NAME: immich
          DB_USERNAME:
            valueFrom:
              secretKeyRef:
                name: cnpg-immich-database-app
                key: username
          DB_PASSWORD:
            valueFrom:
              secretKeyRef:
                name: cnpg-immich-database-app
                key: password
          REDIS_HOSTNAME: platform.database.svc.cluster.local
          REDIS_PORT: "6379"
          REDIS_PASSWORD:
            valueFrom:
              secretKeyRef:
                name: dragonfly-password
                key: password
        resources:
          requests:
            cpu: 100m
            memory: 512Mi
          limits:
            memory: 2Gi

immich:
  metrics:
    enabled: true
  persistence:
    library:
      existingClaim: immich-library
  configuration: { }
  configurationKind: ConfigMap

valkey:
  enabled: false

server:
  enabled: true
  controllers:
    main:
      containers:
        main:
          image:
            repository: ghcr.io/immich-app/immich-server
            pullPolicy: IfNotPresent
          resources:
            requests:
              cpu: 100m
              memory: 512Mi
            limits:
              memory: 4Gi

machine-learning:
  enabled: true
  controllers:
    main:
      containers:
        main:
          image:
            repository: ghcr.io/immich-app/immich-machine-learning
            pullPolicy: IfNotPresent
          env:
            TRANSFORMERS_CACHE: /cache
            HF_XET_CACHE: /cache/huggingface-xet
            MPLCONFIGDIR: /cache/matplotlib-config
          resources:
            requests:
              cpu: 100m
              memory: 1Gi
            limits:
              memory: 4Gi
  persistence:
    cache:
      enabled: true
      size: 10Gi
      type: persistentVolumeClaim
      accessMode: ReadWriteOnce
      storageClass: fast
