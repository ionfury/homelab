---
# yaml-language-server: $schema=https://raw.githubusercontent.com/datreeio/CRDs-catalog/main/cilium.io/ciliumclusterwidenetworkpolicy_v2.json
apiVersion: cilium.io/v2
kind: CiliumClusterwideNetworkPolicy
metadata:
  name: baseline-health-probes
spec:
  description: >-
    Allow kubelet health probes (liveness/readiness) from node-local addresses.
    Kubelet uses 169.254.x.x link-local addresses for health checks in Cilium.
  endpointSelector:
    matchExpressions:
      # Apply to all pods (no label restrictions)
      - key: reserved.none
        operator: DoesNotExist
  ingress:
    # Allow health probe traffic from Cilium's health identity
    - fromEntities:
        - health
    # Allow health probe traffic from node-local addresses (169.254.0.0/16)
    # This is needed because kubelet health probes appear as "world" in Cilium
    - fromCIDR:
        - 169.254.0.0/16
