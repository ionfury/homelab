---
apiVersion: v1
kind: ConfigMap
metadata:
  name: kromgo-config
data:
  config.yaml: |
    metrics:
      - name: cluster_uptime
        query: round((time() - min(node_boot_time_seconds)) / 86400)
        suffix: " days"
        colors:
          - { color: "red", min: 0, max: 7 }
          - { color: "yellow", min: 7, max: 30 }
          - { color: "green", min: 30, max: 9999 }

      - name: node_count
        query: count(kube_node_info)
        suffix: " nodes"
        colors:
          - { color: "green", min: 1, max: 9999 }

      - name: pod_count
        query: count(kube_pod_info)
        suffix: " pods"
        colors:
          - { color: "green", min: 1, max: 9999 }

      - name: cluster_cpu_usage
        query: round(avg(1 - rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100, 0.1)
        suffix: "%"
        colors:
          - { color: "green", min: 0, max: 50 }
          - { color: "yellow", min: 50, max: 80 }
          - { color: "red", min: 80, max: 100 }

      - name: cluster_memory_usage
        query: round((1 - sum(node_memory_MemAvailable_bytes) / sum(node_memory_MemTotal_bytes)) * 100, 0.1)
        suffix: "%"
        colors:
          - { color: "green", min: 0, max: 50 }
          - { color: "yellow", min: 50, max: 80 }
          - { color: "red", min: 80, max: 100 }

      - name: kubernetes_version
        query: kubernetes_build_info{service="kubernetes"}
        label: git_version
        colors:
          - { color: "blue", min: 0, max: 0 }
