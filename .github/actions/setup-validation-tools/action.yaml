---
# yaml-language-server: $schema=https://json.schemastore.org/github-action.json
name: "Setup Validation Tools"
description: "Install tools for Kubernetes manifest validation"

inputs:
  kustomize-version:
    description: "Kustomize version"
    default: "5.4.1"
  kubeconform-version:
    description: "Kubeconform version"
    default: "0.6.7"
  yq-version:
    description: "yq version"
    default: "4.44.1"
  flux-operator-version:
    description: "Flux Operator version"
    default: "0.40.0"

runs:
  using: "composite"
  steps:
    - name: Install kustomize
      uses: imranismail/setup-kustomize@v2.1.0
      with:
        kustomize-version: ${{ inputs.kustomize-version }}

    - name: Install kubeconform
      shell: bash
      run: |
        curl -sSL "https://github.com/yannh/kubeconform/releases/download/v${{ inputs.kubeconform-version }}/kubeconform-linux-amd64.tar.gz" | tar xz
        sudo mv kubeconform /usr/local/bin/

    - name: Install yq
      shell: bash
      run: |
        curl -sSL "https://github.com/mikefarah/yq/releases/download/v${{ inputs.yq-version }}/yq_linux_amd64" -o yq
        chmod +x yq
        sudo mv yq /usr/local/bin/

    - name: Install flux-operator
      shell: bash
      run: |
        curl -sSL "https://github.com/controlplaneio-fluxcd/flux-operator/releases/download/v${{ inputs.flux-operator-version }}/flux-operator_${{ inputs.flux-operator-version }}_linux_amd64.tar.gz" | tar xz
        sudo mv flux-operator /usr/local/bin/
