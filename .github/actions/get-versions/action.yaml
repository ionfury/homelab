# yaml-language-server: $schema=https://json.schemastore.org/github-action.json
name: Get Versions
description: Get terragrunt and tofu/terraform versions from local .*-version files

inputs:
  tf-version-file:
    description: File containing TF version
    default: .opentofu-version
    required: false
  tg-version-file:
    description: File containing TG version
    default: .terragrunt-version
    required: false

outputs:
  tf-version:
    description: TF version to be used.
    value: ${{ steps.get-versions.outputs.tf_version }}
  tg-version:
    description: TG version to be used.
    value: ${{ steps.get-versions.outputs.tg_version }}

runs:
  using: "composite"
  steps:
    - name: Read version files and export
      id: get-versions
      uses: actions/github-script@v7
      with:
        script: |
          const fs = require('fs');

          const tfPath = core.getInput('tf-version-file') || '.opentofu-version';
          const tgPath = core.getInput('tg-version-file') || '.terragrunt-version';

          const tfVersion = fs.readFileSync(tfPath, 'utf8').trim();
          const tgVersion = fs.readFileSync(tgPath, 'utf8').trim();

          core.info(`tf_version: ${tfVersion}`);
          core.info(`tg_version: ${tgVersion}`);

          core.setOutput('tf_version', tfVersion);
          core.setOutput('tg_version', tgVersion);
